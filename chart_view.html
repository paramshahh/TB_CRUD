<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Historical Data Frontend</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }

        .header-column {
            background-color: #333;
            color: #fff;
            padding: 20px;
            text-align: center;
        }

        .header-column h1 {
            margin: 0;
        }

        #historicalDataForm {
            max-width: 600px;
            margin: 20px auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        #historicalDataForm label {
            display: block;
            margin-bottom: 10px;
            color: #333;
        }

        #historicalDataForm input {
            width: 100%;
            padding: 8px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }

        #historicalDataForm button {
            width: 100%;
            background-color: #FFD700;
            color: white;
            padding: 14px 20px;
            margin: 8px 0;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        #chart {
            max-width: 800px;
            margin: 20px auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        #plotlyGuidelines {
            text-align: center;
            font-size: 14px;
            color: #333;
        }
    </style>
</head>

<body>
    <div class="header-column">
        <h1>Historical Data</h1>
    </div>

    <form id="historicalDataForm">
        <label for="symbol">Symbol:</label>
        <input type="text" id="symbol" name="symbol" placeholder="Enter symbol (e.g., NIFTY%2050)" required>

        <label for="fromDate">From Date:</label>
        <input type="date" id="fromDate" name="from_date" required>

        <label for="toDate">To Date:</label>
        <input type="date" id="toDate" name="to_date" required>

        <button type="submit">Get Historical Data</button>
    </form>

    <div id="plotlyGuidelines">
        <p><b>GUIDELINES FOR USING THE CHART:</b></p>
        <ul>
            <li>Hover over data points to see details</li>
            <li>Click and drag on the chart to zoom in</li>
            <li>Double-click on the chart to reset zoom</li>
        </ul>
    </div>

    <div id="chart"></div>

    <script>
        document.getElementById('historicalDataForm').addEventListener('submit', async function (event) {
            event.preventDefault();

            const symbol = document.getElementById('symbol').value;
            const fromDate = new Date(document.getElementById('fromDate').value).toISOString().split('T')[0];
            const toDate = new Date(document.getElementById('toDate').value).toISOString().split('T')[0];

            try {
                const response = await fetch(`http://localhost:3001/historical-data?symbol=${symbol}&from_date=${fromDate}&to_date=${toDate}`);

                const data = await response.json();

                const dates = [];
                const prices = [];

                data.forEach(item => {
                    dates.push(item.date);
                    prices.push(item.price);
                });

                const chartElement = document.getElementById('chart');
                chartElement.innerHTML = '';

                const layout = {
                    title: 'Historical Data',
                    xaxis: {
                        title: 'Date',
                        type: 'category',
                        categoryorder: 'array',
                        categoryarray: dates
                    },
                    yaxis: {
                        title: 'Price'
                    },
                    plot_bgcolor: 'rgba(255, 255, 255, 0.95)',
                    paper_bgcolor: 'rgba(255, 255, 255, 0.95)',
                    font: {
                        color: '#333'
                    }
                };

                Plotly.newPlot('chart', [{
                    x: dates,
                    y: prices,
                    type: 'scatter',
                    mode: 'lines+markers',
                    marker: {
                        color: '#FFD700'
                    }
                }], layout);
            } catch (error) {
                console.error('Error fetching data:', error);
            }
        });
    </script>
</body>

</html>